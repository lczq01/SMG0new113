# 学生管理系统后端开发任务文档

## 项目概述

本后端系统是为学生管理系统设计的服务端解决方案，主要用于支持教师管理学生信息、考试排名、学生标准和违规情况，同时为学生提供数据查询服务。系统采用 Node.js + Express + MySQL 技术栈，提供完整的 RESTful API 接口。

## 技术栈

* **后端框架**：Node.js + Express

* **数据库**：MySQL

* **ORM**：Sequelize

* **认证**：JWT (JSON Web Token)

* **API文档**：Swagger

* **环境配置**：dotenv

* **测试**：Jest + Supertest

## 执行步骤

### 初始化与配置阶段

#### 步骤1：创建后端项目目录

* **步骤ID**：T-backend-001

* **步骤名称**：创建后端项目目录

* **步骤描述**：在项目根目录下创建后端项目目录结构

* **验证方法**：检查目录结构是否正确创建

* **AI指令**：在项目根目录创建 `backend` 目录，包含 `src`、`config`、`migrations`、`seeds` 等子目录

#### 步骤2：初始化 Node.js 项目

* **步骤ID**：T-backend-002

* **步骤名称**：初始化 Node.js 项目

* **步骤描述**：在后端目录初始化一个新的 Node.js 项目

* **验证方法**：检查 package.json 文件是否正确创建

* **AI指令**：在 backend 目录执行 `npm init -y` 命令初始化项目

#### 步骤3：安装核心依赖

* **步骤ID**：T-backend-003

* **步骤名称**：安装核心依赖

* **步骤描述**：安装 Express、MySQL、Sequelize、JWT 等核心依赖

* **验证方法**：检查 package.json 文件中是否包含这些依赖

* **AI指令**：执行 `npm install express mysql2 sequelize jsonwebtoken cors dotenv` 安装核心依赖

#### 步骤4：安装开发依赖

* **步骤ID**：T-backend-004

* **步骤名称**：安装开发依赖

* **步骤描述**：安装 TypeScript、Jest、Supertest 等开发依赖

* **验证方法**：检查 package.json 文件中是否包含这些开发依赖

* **AI指令**：执行 `npm install --save-dev typescript @types/express @types/jsonwebtoken @types/cors @types/jest jest supertest ts-jest nodemon` 安装开发依赖

#### 步骤5：配置环境变量

* **步骤ID**：T-backend-005

* **步骤名称**：配置环境变量

* **步骤描述**：创建 .env 文件，配置数据库连接和 JWT 密钥

* **验证方法**：检查 .env 文件是否正确配置

* **AI指令**：创建 .env 文件，配置数据库连接信息（主机、端口、用户名、密码、数据库名）和 JWT 密钥

### 数据库设计与迁移阶段

#### 步骤6：创建数据库配置文件

* **步骤ID**：T-backend-006

* **步骤名称**：创建数据库配置文件

* **步骤描述**：创建 Sequelize 数据库配置文件

* **验证方法**：检查数据库配置文件是否正确创建

* **AI指令**：创建 `config/database.js` 文件，配置 Sequelize 连接参数

#### 步骤7：定义数据模型

* **步骤ID**：T-backend-007

* **步骤名称**：定义数据模型

* **步骤描述**：创建与前端类型匹配的数据模型

* **验证方法**：检查数据模型是否与前端类型定义一致

* **AI指令**：创建 `src/models` 目录，定义 Student、ExamRanking、Standard、Violation、Alert 等数据模型

#### 步骤8：创建数据库迁移文件

* **步骤ID**：T-backend-008

* **步骤名称**：创建数据库迁移文件

* **步骤描述**：创建数据库表结构的迁移文件

* **验证方法**：检查迁移文件是否正确创建

* **AI指令**：使用 Sequelize CLI 创建数据库迁移文件，定义表结构和字段

#### 步骤9：执行数据库迁移

* **步骤ID**：T-backend-009

* **步骤名称**：执行数据库迁移

* **步骤描述**：执行迁移文件创建数据库表结构

* **验证方法**：检查数据库表结构是否正确创建

* **AI指令**：执行 `npx sequelize-cli db:migrate` 命令创建数据库表结构

#### 步骤10：创建种子数据

* **步骤ID**：T-backend-010

* **步骤名称**：创建种子数据

* **步骤描述**：创建初始测试数据

* **验证方法**：检查数据库中是否包含测试数据

* **AI指令**：创建 `seeds` 目录，定义初始测试数据，执行 `npx sequelize-cli db:seed:all` 命令导入测试数据

### API 实现阶段

#### 步骤11：创建 Express 应用

* **步骤ID**：T-backend-011

* **步骤名称**：创建 Express 应用

* **步骤描述**：创建 Express 应用实例，配置中间件

* **验证方法**：检查应用是否正确启动

* **AI指令**：创建 `src/app.js` 文件，配置 Express 应用，添加 CORS、JSON 解析等中间件

#### 步骤12：实现认证中间件

* **步骤ID**：T-backend-012

* **步骤名称**：实现认证中间件

* **步骤描述**：创建 JWT 认证中间件，用于保护 API 接口

* **验证方法**：检查认证中间件是否正确实现

* **AI指令**：创建 `src/middleware/auth.js` 文件，实现 JWT 认证逻辑

#### 步骤13：实现学生相关 API

* **步骤ID**：T-backend-013

* **步骤名称**：实现学生相关 API

* **步骤描述**：实现学生登录和信息查询接口

* **验证方法**：测试学生登录和信息查询接口是否正常工作

* **AI指令**：创建 `src/routes/student.js` 文件，实现学生登录和信息查询接口

#### 步骤14：实现教师相关 API

* **步骤ID**：T-backend-014

* **步骤名称**：实现教师相关 API

* **步骤描述**：实现教师登录接口

* **验证方法**：测试教师登录接口是否正常工作

* **AI指令**：创建 `src/routes/teacher.js` 文件，实现教师登录接口

#### 步骤15：实现排名相关 API

* **步骤ID**：T-backend-015

* **步骤名称**：实现排名相关 API

* **步骤描述**：实现排名查询和管理接口

* **验证方法**：测试排名查询接口是否正常工作

* **AI指令**：创建 `src/routes/ranking.js` 文件，实现排名查询和管理接口

#### 步骤16：实现标准相关 API

* **步骤ID**：T-backend-016

* **步骤名称**：实现标准相关 API

* **步骤描述**：实现标准的增删改查接口

* **验证方法**：测试标准的 CRUD 操作是否正常工作

* **AI指令**：创建 `src/routes/standard.js` 文件，实现标准的增删改查接口

#### 步骤17：实现违规相关 API

* **步骤ID**：T-backend-017

* **步骤名称**：实现违规相关 API

* **步骤描述**：实现违规记录的增删改查接口

* **验证方法**：测试违规记录的 CRUD 操作是否正常工作

* **AI指令**：创建 `src/routes/violation.js` 文件，实现违规记录的增删改查接口

#### 步骤18：实现班级相关 API

* **步骤ID**：T-backend-018

* **步骤名称**：实现班级相关 API

* **步骤描述**：实现班级查询和管理接口

* **验证方法**：测试班级查询接口是否正常工作

* **AI指令**：创建 `src/routes/class.js` 文件，实现班级查询和管理接口

#### 步骤19：实现数据导出 API

* **步骤ID**：T-backend-019

* **步骤名称**：实现数据导出 API

* **步骤描述**：实现完整数据导出接口

* **验证方法**：测试数据导出接口是否正常工作

* **AI指令**：创建 `src/routes/export.js` 文件，实现完整数据导出接口

#### 步骤20：实现预警管理 API

* **步骤ID**：T-backend-020

* **步骤名称**：实现预警管理 API

* **步骤描述**：实现学生预警信息查询接口

* **验证方法**：测试预警信息查询接口是否正常工作

* **AI指令**：创建 `src/routes/alert.js` 文件，实现学生预警信息查询接口

### 集成与测试阶段

#### 步骤21：配置 API 路由

* **步骤ID**：T-backend-021

* **步骤名称**：配置 API 路由

* **步骤描述**：在主应用中配置所有 API 路由

* **验证方法**：检查路由配置是否正确

* **AI指令**：在 `src/app.js` 文件中配置所有 API 路由

#### 步骤22：创建 API 文档

* **步骤ID**：T-backend-022

* **步骤名称**：创建 API 文档

* **步骤描述**：使用 Swagger 创建 API 文档

* **验证方法**：检查 API 文档是否正确生成

* **AI指令**：配置 Swagger，生成 API 文档

#### 步骤23：编写单元测试

* **步骤ID**：T-backend-023

* **步骤名称**：编写单元测试

* **步骤描述**：为所有 API 接口编写单元测试

* **验证方法**：测试覆盖率是否达到 80% 以上

* **AI指令**：创建 `test` 目录，为所有 API 接口编写单元测试

#### 步骤24：测试 API 接口

* **步骤ID**：T-backend-024

* **步骤名称**：测试 API 接口

* **步骤描述**：运行测试用例，验证 API 接口是否正常工作

* **验证方法**：所有测试用例是否通过

* **AI指令**：运行 `npm test` 命令执行测试用例

#### 步骤25：集成前端项目

* **步骤ID**：T-backend-025

* **步骤名称**：集成前端项目

* **步骤描述**：修改前端 API 服务，连接到后端服务

* **验证方法**：前端是否能正常调用后端 API

* **AI指令**：修改前端 `src/services/api.ts` 文件，将模拟 API 替换为真实后端 API

#### 步骤26：创建启动脚本

* **步骤ID**：T-backend-026

* **步骤名称**：创建启动脚本

* **步骤描述**：创建项目启动脚本，配置开发和生产环境

* **验证方法**：检查启动脚本是否正确配置

* **AI指令**：在 package.json 文件中配置启动脚本，包括开发和生产环境

### 部署与运维阶段

#### 步骤27：创建部署配置

* **步骤ID**：T-backend-027

* **步骤名称**：创建部署配置

* **步骤描述**：创建服务器部署配置文件

* **验证方法**：检查部署配置是否正确创建

* **AI指令**：创建 `ecosystem.config.js` 文件，配置 PM2 部署参数

#### 步骤28：编写部署脚本

* **步骤ID**：T-backend-028

* **步骤名称**：编写部署脚本

* **步骤描述**：创建服务器部署脚本

* **验证方法**：检查部署脚本是否正确创建

* **AI指令**：创建 `deploy.sh` 脚本，包含部署和回滚命令

#### 步骤29：编写系统文档

* **步骤ID**：T-backend-029

* **步骤名称**：编写系统文档

* **步骤描述**：创建系统架构和使用文档

* **验证方法**：检查系统文档是否完整

* **AI指令**：创建 `docs` 目录，编写系统架构、API 文档和使用说明

## 数据库设计

### 表结构

#### 1. students 表

* **id**：INT，主键，自增

* **class**：VARCHAR(50)，班级名称

* **name**：VARCHAR(50)，学生姓名

* **studentId**：VARCHAR(20)，学号，唯一

* **createdAt**：DATETIME，创建时间

* **updatedAt**：DATETIME，更新时间

#### 2. exam\_rankings 表

* **id**：INT，主键，自增

* **studentId**：INT，外键，关联 students.id

* **examName**：VARCHAR(100)，考试名称

* **ranking**：INT，排名

* **createdAt**：DATETIME，创建时间

#### 3. standards 表

* **id**：INT，主键，自增

* **studentId**：INT，外键，关联 students.id

* **name**：VARCHAR(100)，标准名称

* **value**：INT，标准值

* **createdAt**：DATETIME，创建时间

* **updatedAt**：DATETIME，更新时间

#### 4. violations 表

* **id**：INT，主键，自增

* **studentId**：INT，外键，关联 students.id

* **type**：VARCHAR(100)，违规类型

* **violationDate**：DATETIME，违规时间

* **createdAt**：DATETIME，创建时间

#### 5. alerts 表

* **id**：INT，主键，自增

* **studentId**：INT，外键，关联 students.id

* **type**：ENUM('continuous\_declining', 'multiple\_violations', 'declining\_and\_violation')，预警类型

* **typeText**：VARCHAR(100)，预警类型文本

* **reason**：TEXT，预警原因

* **createdAt**：DATETIME，创建时间

#### 6. teachers 表

* **id**：INT，主键，自增

* **username**：VARCHAR(50)，用户名，唯一

* **password**：VARCHAR(100)，密码（哈希存储）

* **createdAt**：DATETIME，创建时间

* **updatedAt**：DATETIME，更新时间

## API 接口设计

### 1. 学生相关接口

#### 1.1 学生登录

* **URL**：`/api/student/login`

* **方法**：POST

* **参数**：`{ "class": "高一(1)班", "name": "张三", "studentId": "2024001" }`

* **响应**：`{ "success": true, "message": "登录成功", "data": { "id": 1, "class": "高一(1)班", "name": "张三", "studentId": "2024001", "createdAt": "2024-01-01T00:00:00Z", "updatedAt": "2024-01-01T00:00:00Z" }, "token": "jwt-token" }`

#### 1.2 获取学生信息

* **URL**：`/api/student/:id`

* **方法**：GET

* **认证**：需要 JWT token

* **响应**：`{ "success": true, "message": "获取成功", "data": { "id": 1, "class": "高一(1)班", "name": "张三", "studentId": "2024001", "createdAt": "2024-01-01T00:00:00Z", "updatedAt": "2024-01-01T00:00:00Z" } }`

### 2. 教师相关接口

#### 2.1 教师登录

* **URL**：`/api/teacher/login`

* **方法**：POST

* **参数**：`{ "username": "teacher", "password": "teacher123" }`

* **响应**：`{ "success": true, "message": "登录成功", "data": true, "token": "jwt-token" }`

### 3. 排名相关接口

#### 3.1 获取所有排名

* **URL**：`/api/ranking`

* **方法**：GET

* **认证**：需要 JWT token（教师）

* **响应**：`{ "success": true, "message": "获取成功", "data": [ { "id": 1, "studentId": 1, "examName": "期中考试", "ranking": 52, "createdAt": "2024-10-01T00:00:00Z" } ] }`

#### 3.2 获取学生排名

* **URL**：`/api/ranking/student/:id`

* **方法**：GET

* **认证**：需要 JWT token

* **响应**：`{ "success": true, "message": "获取成功", "data": [ { "id": 1, "studentId": 1, "examName": "期中考试", "ranking": 52, "createdAt": "2024-10-01T00:00:00Z" } ] }`

### 4. 标准相关接口

#### 4.1 获取所有标准

* **URL**：`/api/standard`

* **方法**：GET

* **认证**：需要 JWT token（教师）

* **响应**：`{ "success": true, "message": "获取成功", "data": [ { "id": 1, "studentId": 1, "name": "作业标准", "value": 5, "createdAt": "2024-01-01T00:00:00Z", "updatedAt": "2024-01-01T00:00:00Z" } ] }`

#### 4.2 获取学生标准

* **URL**：`/api/standard/student/:id`

* **方法**：GET

* **认证**：需要 JWT token

* **响应**：`{ "success": true, "message": "获取成功", "data": [ { "id": 1, "studentId": 1, "name": "作业标准", "value": 5, "createdAt": "2024-01-01T00:00:00Z", "updatedAt": "2024-01-01T00:00:00Z" } ] }`

#### 4.3 创建标准

* **URL**：`/api/standard`

* **方法**：POST

* **认证**：需要 JWT token（教师）

* **参数**：`{ "studentId": 1, "name": "作业标准", "value": 5 }`

* **响应**：`{ "success": true, "message": "创建成功", "data": { "id": 1, "studentId": 1, "name": "作业标准", "value": 5, "createdAt": "2024-01-01T00:00:00Z", "updatedAt": "2024-01-01T00:00:00Z" } }`

#### 4.4 更新标准

* **URL**：`/api/standard/:id`

* **方法**：PUT

* **认证**：需要 JWT token（教师）

* **参数**：`{ "name": "作业标准", "value": 4 }`

* **响应**：`{ "success": true, "message": "更新成功", "data": { "id": 1, "studentId": 1, "name": "作业标准", "value": 4, "createdAt": "2024-01-01T00:00:00Z", "updatedAt": "2024-01-01T00:00:00Z" } }`

#### 4.5 删除标准

* **URL**：`/api/standard/:id`

* **方法**：DELETE

* **认证**：需要 JWT token（教师）

* **响应**：`{ "success": true, "message": "删除成功", "data": true }`

### 5. 违规相关接口

#### 5.1 获取所有违规记录

* **URL**：`/api/violation`

* **方法**：GET

* **认证**：需要 JWT token（教师）

* **响应**：`{ "success": true, "message": "获取成功", "data": [ { "id": 1, "studentId": 1, "type": "迟到", "violationDate": "2024-01-15T00:00:00Z", "createdAt": "2024-01-15T00:00:00Z" } ] }`

#### 5.2 获取学生违规记录

* **URL**：`/api/violation/student/:id`

* **方法**：GET

* **认证**：需要 JWT token

* **响应**：`{ "success": true, "message": "获取成功", "data": [ { "id": 1, "studentId": 1, "type": "迟到", "violationDate": "2024-01-15T00:00:00Z", "createdAt": "2024-01-15T00:00:00Z" } ] }`

#### 5.3 创建违规记录

* **URL**：`/api/violation`

* **方法**：POST

* **认证**：需要 JWT token（教师）

* **参数**：`{ "studentId": 1, "type": "迟到", "violationDate": "2024-01-15T00:00:00Z" }`

* **响应**：`{ "success": true, "message": "创建成功", "data": { "id": 1, "studentId": 1, "type": "迟到", "violationDate": "2024-01-15T00:00:00Z", "createdAt": "2024-01-15T00:00:00Z" } }`

#### 5.4 删除违规记录

* **URL**：`/api/violation/:id`

* **方法**：DELETE

* **认证**：需要 JWT token（教师）

* **响应**：`{ "success": true, "message": "删除成功", "data": true }`

### 6. 班级相关接口

#### 6.1 获取所有班级

* **URL**：`/api/class`

* **方法**：GET

* **认证**：需要 JWT token（教师）

* **响应**：`{ "success": true, "message": "获取成功", "data": [ "高一(1)班", "高一(2)班" ] }`

### 7. 数据导出接口

#### 7.1 导出完整数据

* **URL**：`/api/export`

* **方法**：GET

* **认证**：需要 JWT token（教师）

* **响应**：`{ "success": true, "message": "导出成功", "data": { "students": [], "rankings": [], "standards": [], "violations": [] } }`

### 8. 预警相关接口

#### 8.1 获取预警信息

* **URL**：`/api/alert`

* **方法**：GET

* **认证**：需要 JWT token（教师）

* **响应**：`{ "success": true, "message": "获取成功", "data": [ { "id": 1, "studentId": 1, "type": "continuous_declining", "typeText": "连续退步", "reason": "最近三次考试排名依次退步", "createdAt": "2024-01-01T00:00:00Z" } ] }`

## 项目结构

```
backend/
├── src/
│   ├── app.js              # Express 应用
│   ├── config/             # 配置文件
│   ├── middleware/         # 中间件
│   ├── models/             # 数据模型
│   ├── routes/             # API 路由
│   ├── services/           # 业务逻辑
│   └── utils/              # 工具函数
├── config/                 # 数据库配置
├── migrations/             # 数据库迁移文件
├── seeds/                  # 种子数据
├── test/                   # 测试文件
├── .env                    # 环境变量
├── package.json            # 项目配置
└── README.md               # 项目说明
```

## 技术要点

1. **数据关联**：使用 Sequelize 实现数据模型之间的关联关系
2. **认证安全**：使用 JWT 实现无状态认证，密码哈希存储
3. **错误处理**：统一的错误处理机制，返回标准化的错误响应
4. **数据验证**：使用 Express-validator 进行请求数据验证
5. **性能优化**：使用数据库索引，优化查询性能
6. **安全防护**：实现 CORS、防止 SQL 注入、XSS 攻击等安全措施
7. **预警逻辑**：实现连续退步、累计违规、一次退步+一次违规的预警计算
8. **排名计算**：实现最新考试排名与前两次考试最佳排名的比较

## 测试账号

### 教师账号

* **用户名**：teacher

* **密码**：teacher123

### 学生账号

* **班级**：高一(1)班

* **姓名**：张三

* **学号**：2024001

## 部署说明

1. **环境要求**：Node.js 16+，MySQL 5.7+
2. **安装依赖**：`npm install`
3. **配置环境**：复制 `.env.example` 为 `.env`，修改配置
4. **数据库迁移**：`npx sequelize-cli db:migrate`
5. **导入种子数据**：`npx sequelize-cli db:seed:all`
6. **启动服务**：`npm start`（生产环境）或 `npm run dev`（开发环境）
7. **API文档**：访问 `http://localhost:3000/api-docs`

## 后续维护

1. **数据库备份**：定期备份 MySQL 数据库
2. **日志管理**：配置日志系统，定期清理日志
3. **性能监控**：监控 API 响应时间和数据库性能
4. **安全更新**：定期更新依赖包，修复安全漏洞
5. **扩展功能**：根据需求扩展 API 接口和业务逻辑

